###############################################################################
#
# tkt-b4a7ddc83f.eagle --
#
# Written by Joe Mistachkin.
# Released to the public domain, use at your own risk!
#
###############################################################################

package require Eagle
package require EagleLibrary
package require EagleTest

runTestPrologue

###############################################################################

source [file join $path common.eagle]
runSQLiteTestPrologue

###############################################################################

runTest {test tkt-b4a7ddc83f-1.1 {logging shutdown, step 1} -setup [subst {
  set fileName tkt-b4a7ddc83f-1.1.db
  set ::path {$::path}
  set ::test_configuration {$::test_configuration}
  source [file join $::path common.eagle]
}] -body {
  package require EagleTest
  tryLoadAssembly System.Data.SQLite.dll
  object invoke System.Data.SQLite.SQLiteLog Initialize
  setupDb $fileName
} -cleanup {
  cleanupDb $fileName
  unset -nocomplain db fileName
} -constraints {eagle monoBug28 command.sql compile.DATA\
compile.ISOLATED_INTERPRETERS System.Data.SQLite} -isolationLevel AppDomain \
-match regexp -result {^SQLiteConnection#\d+$}}

###############################################################################

runTest {test tkt-b4a7ddc83f-1.2 {logging shutdown, step 2} -setup [subst {
  set fileName tkt-b4a7ddc83f-1.2.db
  set ::path {$::path}
  set ::test_configuration {$::test_configuration}
  source [file join $::path common.eagle]
}] -body {
  package require EagleTest
  tryLoadAssembly System.Data.SQLite.dll
  object invoke System.Data.SQLite.SQLiteLog Initialize
  setupDb $fileName
} -cleanup {
  cleanupDb $fileName
  unset -nocomplain db fileName
} -constraints {eagle monoBug28 command.sql compile.DATA\
compile.ISOLATED_INTERPRETERS System.Data.SQLite} -isolationLevel AppDomain \
-match regexp -result {^SQLiteConnection#\d+$}}

###############################################################################

runSQLiteTestEpilogue
runTestEpilogue
